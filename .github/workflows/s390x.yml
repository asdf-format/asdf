name: s390x

on:
  workflow_dispatch:
  push:
    tags:
      - '*'
  schedule:
    # Run every Monday at 6am UTC
    - cron: '0 6 * * 1'

jobs:
  pytest:
    runs-on: ubuntu-18.04
    name: Python 3.8
    timeout-minutes: 600
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
          submodules: true
      - uses: uraimo/run-on-arch-action@v2.1.1
        name: Run tests
        id: build
        with:
          arch: s390x
          distro: ubuntu18.04
          shell: /bin/bash
          install: |
            apt-get update -q -y
            apt-get install -q -y build-essential gfortran libopenblas-dev liblapack-dev
            apt-get install -q -y software-properties-common
            add-apt-repository -y ppa:deadsnakes/ppa
            apt-get install -q -y git python3.8 python3.8-dev python3.8-venv
          run: |
            /usr/bin/python3.8 -m venv .venv
            source .venv/bin/activate
            pip install -e .[all,tests]
            pytest --remote-data
